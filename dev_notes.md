PLEASE remember to use vector.size() instead of max_size(). this lack of awareness caused a long-standing bug in shop.cpp
